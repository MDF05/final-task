<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <link rel="stylesheet" href="../../node_modules//bootstrap/dist/css/bootstrap.css">
    <%- css %>
    <link rel="stylesheet" href="/assets/css/template.css">
</head>

<body class="bg-black">
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
        <div class="offcanvas-header bg-black">

            <button type="button" class="btn-close bg-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body bg-black">
            <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                <li class="nav-item">
                    <ul class="bg-glasses list-group list-unstyled" id="dropdown-nav">
                        <li class="border-bottom mb-1 pb-2">
                            <a class="dropdown-item color-skyblue d-flex gap-2 justify-content-between" href="#">
                                <span>
                                    <%= user ? user.username : "username" %> <br>
                                    <%= user ? user.email : "" %>
                                </span>
                                <img src="/<%= user.imageUrl ? user?.imageUrl: 'assets//images/default-avatar.png'  %>"
                                    alt="user-image" class="rounded-circle bg-skyblue border border-2 border-skyblue"
                                    style="width: 40px; height: 40px;">
                            </a>
                            <hr class="dropdown-divider border-skyblue">
                        </li>
                        <li>
                            <a class="dropdown-item color-skyblue <%= active == 'edit-profile' ? 'active-page' : '' %>"
                                href="edit-profile">
                                edit profile
                            </a>
                        </li>
                        <li><a class="dropdown-item color-skyblue <%= active == 'password' ? 'active-page' : '' %> "
                                href="change-password">change
                                password</a></li>
                        <li><a class="dropdown-item color-skyblue" href="/logout">log
                                out</a></li>
                        <li>
                            <a class="dropdown-item color-skyblue <%= active == 'login' ? 'active-page' : '' %> "
                                href="/login">log
                                in</a>
                        </li>
                        <li>
                            <a class="dropdown-item color-skyblue <%= active == 'register' ? 'active-page' : '' %> "
                                href="/register">
                                register
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="nav-item border-bottom mb-1 pb-1">

                </li>
                <li class="nav-item m-0 d-flex flex-column gap-0">
                    <a class="nav-link color-skyblue m-0 p-0  <%= active == 'provinsi' ? 'active-page' : '' %>"
                        aria-current="page" href="/?view=provinsi">Provinsi</a>
                    <a class="nav-link color-skyblue  m-0 p-0 <%= active == 'kabupaten' ? 'active-page' : '' %>"
                        aria-current="page" href="/?view=kabupaten">Kabupaten</a>
                </li>

        </div>
    </div>

    <nav class="navbar navbar-expand-lg bg-glasses bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand color-skyblue" href="#">Dava</a>
            <button class="navbar-toggler color-skyblue border border-skyblue py-1 px-0" type="button"
                data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar"
                aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarText">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link color-skyblue <%= active == 'provinsi' ? 'active-page' : '' %>"
                            aria-current="page" href="/?view=provinsi">Provinsi</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link color-skyblue <%= active == 'kabupaten' ? 'active-page' : '' %>"
                            aria-current="page" href="/?view=kabupaten">Kabupaten</a>
                    </li>
                </ul>
                <div class="btn-group position-relative">
                    <button type="button" class="btn dropdown-toggle bg-glasses m-0 py-0 px-2" data-bs-toggle="dropdown"
                        aria-expanded="false" id="button-dropdown-profile">
                        <img src="/<%= user.imageUrl ? user?.imageUrl: 'assets//images/default-avatar.png'  %>"
                            alt="user-image" class="rounded-circle bg-skyblue border border-2 border-skyblue"
                            style="width: 40px; height: 40px; ">
                    </button>
                    <ul class="dropdown-menu position-absolute bg-glasses" id="dropdown-nav">
                        <li>
                            <a class="dropdown-item color-skyblue d-flex justify-content-between gap-3" href="#">
                                <span>
                                    <%= user ? user.username : "username" %> <br>
                                    <%= user ? user.email : "" %>
                                </span>
                                <img src="/<%= user.imageUrl ? user?.imageUrl : 'assets//images/default-avatar.png'  %>"
                                    alt="user-image" class="rounded-circle bg-skyblue border border-2 border-skyblue"
                                    style="width: 40px; height: 40px;">
                            </a>
                        </li>
                        <li>
                            <hr class="dropdown-divider border-skyblue">
                        </li>
                        <li>
                            <a class="dropdown-item color-skyblue <%= active == 'edit-profile' ? 'active-page' : '' %>"
                                href="edit-profile">
                                edit profile
                            </a>
                        </li>
                        <li><a class="dropdown-item color-skyblue <%= active == 'password' ? 'active-page' : '' %> "
                                href="change-password">change
                                password</a></li>
                        <li><a class="dropdown-item color-skyblue" href="/logout">log
                                out</a></li>
                        <li>
                            <a class="dropdown-item color-skyblue <%= active == 'login' ? 'active-page' : '' %> "
                                href="/login">log
                                in</a>
                        </li>
                        <li>
                            <a class="dropdown-item color-skyblue <%= active == 'register' ? 'active-page' : '' %> "
                                href="/register">
                                register
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

    </nav>

    <% if(messages.succes) { %>
    <% messages.succes.forEach(msg => { %>
    <div class="alert alert-success alert-dismissible fade show position-fixed top-0 w-100" role="alert"
        style="z-index: 100;">
        <%= msg  %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <% } )%>
    <% } %>

    <% if(messages.danger) { %>
    <% messages.danger.forEach(msg => { %>
    <div class="alert alert-danger alert-dismissible fade show position-fixed top-0 w-100" role="alert"
        style="z-index: 100;">
        <%= msg  %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <% } )%>
    <% } %>

    <%- body %>

    <%- js %>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
    </script>
    <script>
        const alerts = document.querySelectorAll(".alert")
        setTimeout(() => {
            alerts.forEach(alert => {
                alert.classList.add("d-none")
            })
        }, 4000)

        const updateInput = document.querySelector(".imageProject")
        const previewImage = document.querySelector(".preview-image")
        fileInput(previewImage.src)

        updateInput.addEventListener("change", (event) => {
            const newImage = URL.createObjectURL(updateInput.files[0])
            previewImage.src = newImage

        })

        function fileInput(srcImg) {
            fetch(srcImg).then(response => response.blob()).then(response => {
                let sourceImage = srcImg.split("/")
                sourceImage = sourceImage[sourceImage.length - 1]

                sourceImage = sourceImage.replaceAll("%20", " ")

                let file = new File([response], sourceImage, {
                    type: "image/jpeg",
                    lastModified: new Date().getTime()
                }, 'utf-8');
                let container = new DataTransfer();
                container.items.add(file);
                updateInput.files = container.files;
            })
        }
    </script>

</body>

</html>